<view class="page">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <van-loading size="48rpx" color="#1890FF">åŠ è½½ä¸­...</van-loading>
  </view>

  <view wx:else class="container">
    <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
    <view class="user-card">
      <view class="user-info">
        <view class="avatar">
          <text class="avatar-text">{{userInfo.name[0] || 'å­¦'}}</text>
        </view>
        <view class="info">
          <view class="name">{{userInfo.name || 'å­¦å‘˜'}}</view>
          <view class="class-name">{{userInfo.className || 'æš‚æ— ç­çº§'}}</view>
        </view>
      </view>
      
      <view class="checkin-section">
        <view class="checkin-stats">
          <text class="streak">ğŸ”¥ è¿ç»­{{checkinStats.consecutiveDays}}å¤©</text>
          <text class="total">ç´¯è®¡{{checkinStats.totalDays}}å¤©</text>
        </view>
        <van-button
          size="small"
          type="{{checkinStats.todayChecked ? 'default' : 'primary'}}"
          round
          disabled="{{checkinStats.todayChecked}}"
          bind:click="handleCheckin"
        >
          {{checkinStats.todayChecked ? 'å·²æ‰“å¡ âœ“' : 'ä»Šæ—¥æ‰“å¡'}}
        </van-button>
      </view>
    </view>

    <!-- ä»Šæ—¥è¯¾ç¨‹ -->
    <view class="section">
      <view class="section-header" bind:tap="goToSchedule">
        <text class="section-title">ğŸ“… ä»Šæ—¥è¯¾ç¨‹</text>
        <text class="section-more">æŸ¥çœ‹å…¨éƒ¨ ></text>
      </view>
      
      <view class="schedule-list" wx:if="{{todaySchedule.length > 0}}">
        <view class="schedule-item" wx:for="{{todaySchedule}}" wx:key="id">
          <view class="schedule-time">
            <text class="time-label">ç¬¬{{item.dayNumber}}å¤©</text>
          </view>
          <view class="schedule-content">
            <view class="subject">{{item.subjectName}}</view>
            <view class="teachers">
              <text wx:if="{{item.morningTeacher}}">ä¸Šåˆ: {{item.morningTeacher}}</text>
              <text wx:if="{{item.afternoonTeacher}}"> | ä¸‹åˆ: {{item.afternoonTeacher}}</text>
            </view>
            <view class="evening" wx:if="{{item.eveningType}}">
              <van-tag type="primary" plain size="medium">æ™šé—´: {{item.eveningType}}</van-tag>
            </view>
          </view>
        </view>
      </view>
      
      <van-empty wx:else description="ä»Šæ—¥æ— è¯¾ç¨‹å®‰æ’" image="search" />
    </view>

    <!-- å¾…åŠä»»åŠ¡ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">âœ… å¾…åŠä»»åŠ¡</text>
      </view>
      
      <view class="task-list">
        <view class="task-item">
          <van-icon name="todo-list-o" size="36rpx" color="#1890FF" />
          <text class="task-text">å®Œæˆä»Šæ—¥ä½œä¸š</text>
          <van-tag type="warning" size="medium">å¾…å®Œæˆ</van-tag>
        </view>
        <view class="task-item">
          <van-icon name="replay" size="36rpx" color="#52C41A" />
          <text class="task-text">å¤ä¹ æ˜¨æ—¥é”™é¢˜</text>
          <van-tag type="success" size="medium">5é“</van-tag>
        </view>
      </view>
    </view>

    <!-- ç£å­¦æ¶ˆæ¯ -->
    <view class="section">
      <view class="section-header" bind:tap="goToMessages">
        <text class="section-title">ğŸ’¬ ç£å­¦æ¶ˆæ¯</text>
        <text class="section-more" wx:if="{{messages.length > 0}}">æŸ¥çœ‹å…¨éƒ¨ ></text>
      </view>
      
      <view class="message-list" wx:if="{{messages.length > 0}}">
        <view class="message-item" wx:for="{{messages}}" wx:key="id" bind:tap="goToMessages">
          <view class="message-avatar">
            <van-icon name="chat-o" size="40rpx" color="#1890FF" />
          </view>
          <view class="message-content">
            <view class="message-title">{{item.title}}</view>
            <view class="message-text">{{item.content}}</view>
            <view class="message-time">{{item.logDate}}</view>
          </view>
        </view>
      </view>
      
      <van-empty wx:else description="æš‚æ— æ¶ˆæ¯" image="search" />
    </view>
  </view>
</view>
