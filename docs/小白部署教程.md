# 零基础部署教程

本教程专为零基础用户编写，按步骤操作即可完成部署。

## 整体流程

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   你的电脑      │    │    GitHub       │    │   你的服务器    │
│   (Mac)         │───▶│    (代码仓库)   │───▶│   (运行系统)    │
│                 │    │                 │    │                 │
│ 写代码 → 推送   │    │  存储代码       │    │  拉取 → 运行    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                              
┌─────────────────┐                          ┌─────────────────┐
│   你的电脑      │         直接上传          │   你的服务器    │
│   (题库文件)    │─────────────────────────▶│   (数据目录)    │
└─────────────────┘                          └─────────────────┘
```

## 第一步：首次部署服务器

### 1.1 连接服务器

打开 Mac 终端（按 `Cmd + 空格`，输入 "终端"）：

```bash
ssh ubuntu@你的服务器IP
```

首次连接会问 `yes/no`，输入 `yes` 然后按回车。

### 1.2 运行部署脚本

连接服务器后，运行以下命令：

```bash
# 下载部署脚本
curl -O https://raw.githubusercontent.com/chaim709/xtj/main/scripts/deploy/server-setup.sh

# 运行部署脚本
chmod +x server-setup.sh
./server-setup.sh
```

等待脚本运行完成（大约 5-10 分钟）。

### 1.3 修改配置

```bash
nano /home/ubuntu/gongkao/.env
```

修改 `SECRET_KEY` 为一个随机字符串，然后按 `Ctrl+X`，按 `Y`，按回车保存。

## 第二步：上传题库数据

### 2.1 修改上传脚本

在你的 Mac 上，编辑上传脚本：

```bash
cd ~/CodeBuddy/公考项目
nano scripts/deploy/upload-data.sh
```

把 `SERVER_IP="你的服务器IP"` 改成你的实际服务器 IP。

### 2.2 运行上传

```bash
chmod +x scripts/deploy/upload-data.sh
./scripts/deploy/upload-data.sh
```

选择 `3` 上传全部数据，等待上传完成。

## 第三步：启动服务

在服务器上运行：

```bash
sudo systemctl start gongkao
```

然后访问 `http://你的服务器IP:5000` 即可看到系统。

---

## 日常操作

### 更新代码（每次修改后）

**在你的 Mac 上：**

```bash
cd ~/CodeBuddy/公考项目

# 1. 提交代码到 GitHub
git add -A
git commit -m "更新xxx功能"
git push

# 2. 连接服务器
ssh ubuntu@你的服务器IP

# 3. 运行更新脚本
./update.sh
```

就这么简单！

### 上传新题库

在你的 Mac 上运行：

```bash
cd ~/CodeBuddy/公考项目
./scripts/deploy/upload-data.sh
```

### 查看服务状态

```bash
# 查看是否在运行
sudo systemctl status gongkao

# 查看实时日志
sudo journalctl -u gongkao -f

# 重启服务
sudo systemctl restart gongkao
```

---

## 常见问题

### Q: 网页打不开？

```bash
# 检查服务是否运行
sudo systemctl status gongkao

# 如果没运行，启动它
sudo systemctl start gongkao

# 检查防火墙是否开放 5000 端口
sudo ufw allow 5000
```

### Q: 更新后网页没变化？

```bash
# 清除浏览器缓存，或强制刷新 (Cmd+Shift+R)

# 确保代码已推送
git status  # 本地查看
git log -1  # 查看最后一次提交

# 服务器上拉取
cd /home/ubuntu/gongkao && git pull
```

### Q: 上传数据很慢？

正常的，特别是首次上传大量题库文件。建议：
- 使用有线网络
- 分批上传（选择选项 1 或 2）
- 晚上上传，网速更快

---

## 一句话总结

| 操作 | 命令 |
|------|------|
| 连接服务器 | `ssh ubuntu@服务器IP` |
| 更新代码 | Mac推送后，服务器运行 `./update.sh` |
| 上传题库 | Mac运行 `./scripts/deploy/upload-data.sh` |
| 启动服务 | `sudo systemctl start gongkao` |
| 查看日志 | `sudo journalctl -u gongkao -f` |
