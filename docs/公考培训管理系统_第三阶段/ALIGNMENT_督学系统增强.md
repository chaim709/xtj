# 第三阶段 Alignment 文档 - 督学系统增强

## 文档信息

| 项目 | 内容 |
|------|------|
| **任务名称** | 第三阶段 - 督学系统增强 |
| **创建日期** | 2026-01-27 |
| **状态** | 🔄 对齐中 |

---

## 一、项目上下文分析

### 1.1 现有系统概述

公考培训机构管理系统已完成两个阶段的开发：

**第一阶段（已完成）**
- 用户认证与权限管理
- 学员信息管理
- 督学记录管理
- 作业任务管理
- 薄弱知识点标签

**第二阶段（已完成）**
- 课程体系管理（项目→套餐→班型→班次→课表）
- 老师管理与排课
- 考勤管理
- 学员与课程整合
- 工作台升级

### 1.2 技术栈

| 类别 | 技术 |
|------|------|
| 后端框架 | Python Flask 2.3.3 |
| ORM | SQLAlchemy 2.0.21 |
| 数据库 | SQLite（开发/生产） |
| 认证 | Flask-Login 0.6.3 |
| 前端 | Bootstrap 5 + jQuery 3.7 + Jinja2 |
| 图标 | Lucide Icons |
| 数据处理 | pandas + openpyxl |

### 1.3 现有数据库结构

共17张表：
- 用户相关：users
- 学员相关：students, weakness_tags, module_categories
- 督学相关：supervision_logs
- 作业相关：homework_tasks, homework_submissions
- 课程相关：subjects, projects, packages, class_types, class_batches, schedules, schedule_change_logs
- 老师相关：teachers
- 关联表：student_batches, attendances

### 1.4 现有路由统计

| 模块 | 路由数量 |
|------|----------|
| 认证 | 2 |
| 工作台 | 1 |
| 学员管理 | 12 |
| 督学管理 | 4 |
| 作业管理 | 5 |
| 课程管理 | 50+ |
| **总计** | **74+** |

---

## 二、第三阶段需求分析

### 2.1 原始需求

用户提出以下增强需求：

1. **课表日历视图**：以日历形式展示课程安排
2. **数据分析看板**：全面的数据统计和可视化
3. **API接口开放**：为未来题库系统预留接口
4. **学员详情增强**：显示课程进度、学习轨迹
5. **通知提醒**：督学跟进提醒、课程提醒（可选）

### 2.2 需求边界确认

#### 2.2.1 包含范围

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 课表日历视图 | 独立页面，支持月/周视图切换，班次筛选 | P0 |
| 数据分析看板 | 学员统计、督学统计、课程统计、趋势图 | P0 |
| API接口开放 | RESTful API，返回JSON，供外部系统调用 | P1 |
| 学员详情增强 | 在学员详情页显示课程进度、督学记录汇总 | P1 |
| 通知提醒 | 督学跟进提醒（简化版） | P2 |

#### 2.2.2 不包含范围

| 功能 | 原因 |
|------|------|
| 题库管理系统 | 作为独立项目开发 |
| 学员端APP/小程序 | 未来单独规划 |
| 在线支付 | 超出当前系统范围 |
| 复杂权限管理 | 保持现有admin/supervisor二级权限 |

---

## 三、功能规格

### 3.1 课表日历视图

#### 3.1.1 功能描述

提供一个独立的日历页面，以可视化方式展示所有班次的课程安排。

#### 3.1.2 用户界面

```
┌─────────────────────────────────────────────────────────────────┐
│  课程日历                                                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                   │
│  筛选: [全部班次 ▼] [全部老师 ▼] [全部科目 ▼]  [月视图|周视图]   │
│                                                                   │
│  ◀ 2026年1月 ▶                                                   │
│  ─────────────────────────────────────────────────────────────   │
│  │ 一  │ 二  │ 三  │ 四  │ 五  │ 六  │ 日  │                    │
│  ├─────┼─────┼─────┼─────┼─────┼─────┼─────┤                    │
│  │     │     │  1  │  2  │  3  │  4  │  5  │                    │
│  │     │     │     │     │     │     │     │                    │
│  ├─────┼─────┼─────┼─────┼─────┼─────┼─────┤                    │
│  │  6  │  7  │  8  │  9  │ 10  │ 11  │ 12  │                    │
│  │ 🔵  │ 🔵  │ 🔵  │ 🔵  │ 🔵  │     │     │                    │
│  │江苏 │江苏 │江苏 │江苏 │江苏 │     │     │                    │
│  │事业 │事业 │事业 │事业 │事业 │     │     │                    │
│  ├─────┼─────┼─────┼─────┼─────┼─────┼─────┤                    │
│  │ ... │ ... │ ... │ ... │ ... │ ... │ ... │                    │
│  └─────┴─────┴─────┴─────┴─────┴─────┴─────┘                    │
│                                                                   │
│  点击日期可查看当日详情                                           │
└─────────────────────────────────────────────────────────────────┘
```

#### 3.1.3 功能点

| 功能 | 说明 |
|------|------|
| 月视图 | 展示整月课程，每日显示班次名称 |
| 周视图 | 展示一周课程，显示更多细节（上午/下午/晚上） |
| 班次筛选 | 下拉选择特定班次 |
| 老师筛选 | 下拉选择特定老师的课程 |
| 科目筛选 | 下拉选择特定科目的课程 |
| 日期导航 | 上月/下月、本周/上周/下周 |
| 详情弹窗 | 点击日期显示当日所有课程详情 |
| 快捷跳转 | 从日历跳转到班次详情页 |

#### 3.1.4 数据来源

- `schedules` 表：课表数据
- `class_batches` 表：班次信息
- `teachers` 表：老师信息
- `subjects` 表：科目信息

---

### 3.2 数据分析看板

#### 3.2.1 功能描述

提供全面的数据统计和可视化，帮助管理者了解机构运营情况。

#### 3.2.2 用户界面

```
┌─────────────────────────────────────────────────────────────────┐
│  数据分析                                                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                   │
│  时间范围: [最近7天 ▼]  [2026-01-01] 至 [2026-01-27]            │
│                                                                   │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ │
│  │ 学员总数    │ │ 本月新增    │ │ 今日督学    │ │ 待跟进学员  │ │
│  │   156      │ │    23       │ │    12       │ │    8        │ │
│  │ ↑ 5%      │ │ ↑ 15%      │ │             │ │ ⚠️ 需关注   │ │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ │
│                                                                   │
│  ─────────────────────────────────────────────────────────────   │
│                                                                   │
│  学员增长趋势                         督学工作量                  │
│  ┌─────────────────────────┐       ┌─────────────────────────┐   │
│  │                         │       │ 张老师  ████████ 45     │   │
│  │    📈 折线图            │       │ 李老师  ██████ 32       │   │
│  │                         │       │ 王老师  █████ 28        │   │
│  └─────────────────────────┘       └─────────────────────────┘   │
│                                                                   │
│  ─────────────────────────────────────────────────────────────   │
│                                                                   │
│  学员状态分布                         课程进度                    │
│  ┌─────────────────────────┐       ┌─────────────────────────┐   │
│  │                         │       │ 江苏事业编  ████░░ 68%  │   │
│  │    🥧 饼图              │       │ 国考面试班  ██████░ 85% │   │
│  │                         │       │ 省考笔试班  ██░░░░ 32%  │   │
│  └─────────────────────────┘       └─────────────────────────┘   │
│                                                                   │
│  ─────────────────────────────────────────────────────────────   │
│                                                                   │
│  薄弱知识点分布（Top 10）                                         │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │ 言语-逻辑填空     ████████████████████ 23人              │     │
│  │ 数资-资料分析     ███████████████ 18人                   │     │
│  │ 判断-图形推理     ████████████ 15人                      │     │
│  │ ...                                                      │     │
│  └─────────────────────────────────────────────────────────┘     │
│                                                                   │
└─────────────────────────────────────────────────────────────────┘
```

#### 3.2.3 统计指标

| 类别 | 指标 | 说明 |
|------|------|------|
| **学员统计** | 总数/新增/流失 | 支持按时间段筛选 |
| | 状态分布 | 咨询/试学/在读/结课/退费 |
| | 报考项目分布 | 国考/省考/事业编等 |
| **督学统计** | 督学日志数 | 按督学人员统计 |
| | 跟进覆盖率 | 已跟进/总学员 |
| | 待跟进学员 | 超过N天未跟进 |
| **课程统计** | 班次数量 | 招生中/进行中/已结课 |
| | 课程进度 | 已上课天数/总天数 |
| | 出勤率 | 已记录考勤的出勤情况 |
| **作业统计** | 作业完成率 | 已提交/应提交 |
| | 平均分 | 按班次/科目统计 |
| **薄弱项统计** | Top 10薄弱项 | 按人数排序 |

#### 3.2.4 图表类型

| 图表 | 用途 | 技术 |
|------|------|------|
| 折线图 | 趋势展示（学员增长、督学量） | ECharts |
| 饼图/环形图 | 分布展示（状态、项目） | ECharts |
| 柱状图 | 对比展示（督学工作量、薄弱项） | ECharts |
| 仪表盘 | 完成率、出勤率 | ECharts |
| 雷达图 | 学员能力画像 | ECharts |
| 进度条 | 课程进度 | Bootstrap |

---

### 3.3 API接口开放

#### 3.3.1 功能描述

提供RESTful API接口，返回JSON格式数据，供未来题库系统调用。

#### 3.3.2 接口设计

**基础路径**: `/api/v1/`

**认证方式**: API Key（通过Header传递）

```
Header: X-API-Key: <api_key>
```

**接口列表**:

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/api/v1/students` | 获取学员列表 |
| GET | `/api/v1/students/<id>` | 获取单个学员 |
| GET | `/api/v1/batches` | 获取班次列表 |
| GET | `/api/v1/batches/<id>` | 获取单个班次 |
| GET | `/api/v1/batches/<id>/students` | 获取班次学员 |
| POST | `/api/v1/students/<id>/weakness` | 更新学员薄弱项（题库系统调用） |

#### 3.3.3 响应格式

```json
{
  "success": true,
  "data": { ... },
  "message": "操作成功",
  "pagination": {
    "page": 1,
    "per_page": 20,
    "total": 100
  }
}
```

---

### 3.4 学员详情增强

#### 3.4.1 功能描述

在学员详情页增加更多维度的信息展示。

#### 3.4.2 新增展示内容

| 区块 | 内容 |
|------|------|
| **课程信息** | 报名套餐、所属班次、课程进度 |
| **督学汇总** | 督学记录数、最近一次沟通、沟通频率 |
| **学习状态趋势** | 最近N次学习状态变化（可视化） |
| **考勤统计** | 出勤次数、出勤率、缺勤记录 |
| **作业统计** | 已完成作业、平均分、趋势 |
| **薄弱项** | 已有功能，优化展示 |

---

### 3.5 通知提醒（简化版）

#### 3.5.1 功能描述

在工作台显示需要关注的事项提醒。

#### 3.5.2 提醒类型

| 类型 | 说明 | 触发条件 |
|------|------|----------|
| 跟进提醒 | 学员长时间未跟进 | 超过7天未有督学记录 |
| 课程提醒 | 今日有课程 | 当日有排课 |
| 作业提醒 | 作业即将截止 | 截止前1天 |

#### 3.5.3 展示方式

- 工作台顶部通知栏
- 侧边栏小红点提示
- 列表页面内联提醒

---

## 四、疑问澄清

### 4.1 已确认事项

| 问题 | 确认结果 |
|------|----------|
| 课表日历是否独立页面 | ✅ 是，独立页面 |
| 是否需要拖拽调整课程 | ✅ 第一版不做拖拽，只做点击查看详情 |
| API是否需要认证 | ✅ 是，使用API Key |
| 通知是否需要实时推送 | ❌ 第一版只做页面内提醒 |
| 数据导出功能 | ✅ 第一版不做，后续迭代 |
| API Key管理 | ✅ 统一配置文件管理 |
| 待跟进提醒 | ✅ 需要做，默认7天 |
| 图表库选择 | ✅ 使用功能更全面的 ECharts |

### 4.2 已解决事项

1. **日历拖拽功能**：第一版不做，点击后显示详情弹窗
2. **数据导出**：第一版不做，后续迭代
3. **API访问控制**：统一配置文件管理API Key
4. **提醒跟进天数**：默认7天，可配置

---

## 五、技术约束

### 5.1 前端技术

| 功能 | 技术方案 |
|------|----------|
| 日历组件 | FullCalendar.js（开源日历库，功能全面） |
| 图表 | ECharts（Apache开源，功能全面，交互丰富） |
| 交互 | jQuery + Bootstrap Modal |

### 5.2 后端技术

| 功能 | 技术方案 |
|------|----------|
| API框架 | Flask Blueprint |
| 认证 | 自定义装饰器 + API Key |
| 数据聚合 | SQLAlchemy 聚合查询 |

### 5.3 性能考虑

| 场景 | 优化方案 |
|------|----------|
| 日历数据加载 | 只加载当月数据，切换月份时懒加载 |
| 统计数据 | 考虑缓存热门统计结果 |
| API响应 | 分页、字段筛选 |

---

## 六、验收标准

### 6.1 功能验收

| 功能 | 验收标准 |
|------|----------|
| 课表日历 | 能正确显示所有班次的课程，支持月/周视图切换 |
| 数据看板 | 所有统计指标正确计算，图表正常渲染 |
| API接口 | 接口返回正确JSON格式，认证有效 |
| 学员详情 | 新增信息正确展示 |
| 通知提醒 | 工作台正确显示待跟进学员 |

### 6.2 非功能验收

| 项目 | 标准 |
|------|------|
| 页面加载 | 日历页面加载 < 2秒 |
| API响应 | 响应时间 < 500ms |
| 兼容性 | Chrome/Safari/Edge 最新版本 |
| 代码规范 | 与现有代码风格一致 |

---

## 七、与题库系统的对接规划

### 7.1 数据流向

```
题库系统                              督学系统
    │                                    │
    │ ──── 获取学员列表 ─────────────▶   │  GET /api/v1/students
    │                                    │
    │ ──── 获取班次学员 ─────────────▶   │  GET /api/v1/batches/<id>/students
    │                                    │
    │ ◀──── 推送错题统计 ────────────    │  POST /api/v1/students/<id>/weakness
    │                                    │
```

### 7.2 预留接口

本阶段开放的API接口将为后续题库系统提供数据对接能力。

---

## 八、总结

### 8.1 第三阶段核心目标

1. **可视化增强**：课表日历 + 数据看板
2. **数据能力增强**：API接口开放
3. **用户体验增强**：学员详情页优化 + 通知提醒

### 8.2 下一步

待确认以上需求理解无误后，进入 **Architect（架构）** 阶段，设计详细的技术架构。

---

**请确认以上需求理解是否正确，如有需要调整的地方请告知。**
