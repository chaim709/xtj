# 共识文档 - 个性化学习计划功能

## 文档信息
- **创建日期**：2026-01-28
- **文档版本**：v1.0
- **功能状态**：设计确认

---

## 1. 功能概述

为学员管理系统添加个性化学习计划功能，让督学老师能够针对每个学员制定结构化的学习计划，设置阶段目标，安排任务清单，并追踪执行进度。

### 1.1 核心价值

- **个性化**：根据学员薄弱项和考试日期，定制专属计划
- **可追踪**：任务打勾、目标达成率，清晰可见
- **智能化**：AI辅助生成计划建议，减轻督学工作量
- **数据驱动**：关联作业、考勤数据，自动评估进度

---

## 2. 需求确认

| 项目 | 确认内容 |
|------|---------|
| 计划类型 | 综合型：目标 + 任务 + 时间节点 |
| 时间跨度 | 灵活制定，不固定周期 |
| AI辅助 | 根据学员情况自动生成计划建议 |
| 目标类型 | 正确率目标、数量目标、时间目标 |
| 任务粒度 | 日常任务 + 里程碑 |
| 执行跟踪 | 任务打勾 + 督学评估 + 关联作业考勤 |
| 使用者 | 仅督学老师使用，学员不可见 |

---

## 3. 数据模型设计

### 3.1 学习计划 (StudyPlan)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | Integer | 主键 |
| student_id | Integer | 学员ID（外键） |
| name | String(100) | 计划名称 |
| phase | String(20) | 阶段：foundation/improvement/sprint |
| start_date | Date | 开始日期 |
| end_date | Date | 结束日期（可选） |
| status | String(20) | 状态：active/completed/paused |
| ai_suggestion | Text | AI生成的建议（JSON） |
| notes | Text | 督学备注 |
| created_by | Integer | 创建人ID |
| created_at | DateTime | 创建时间 |
| updated_at | DateTime | 更新时间 |

### 3.2 阶段目标 (PlanGoal)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | Integer | 主键 |
| plan_id | Integer | 所属计划ID |
| goal_type | String(20) | 类型：accuracy/quantity/time |
| module | String(50) | 模块：资料分析/言语理解等 |
| description | String(200) | 目标描述 |
| target_value | Float | 目标值 |
| current_value | Float | 当前值 |
| unit | String(20) | 单位：%/套/分钟 |
| deadline | Date | 截止日期 |
| status | String(20) | 状态：pending/achieved/failed |
| achieved_at | DateTime | 达成时间 |

### 3.3 任务清单 (PlanTask)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | Integer | 主键 |
| plan_id | Integer | 所属计划ID |
| task_type | String(20) | 类型：daily/weekly/milestone |
| title | String(200) | 任务标题 |
| description | Text | 任务描述 |
| priority | Integer | 优先级：1-5 |
| due_date | Date | 截止日期 |
| is_completed | Boolean | 是否完成 |
| completed_at | DateTime | 完成时间 |
| completed_by | Integer | 完成确认人 |

### 3.4 进度记录 (PlanProgress)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | Integer | 主键 |
| plan_id | Integer | 所属计划ID |
| record_date | Date | 记录日期 |
| record_type | String(20) | 类型：evaluation/note |
| content | Text | 记录内容 |
| overall_score | Integer | 整体评分(1-5) |
| created_by | Integer | 记录人 |
| created_at | DateTime | 创建时间 |

---

## 4. 功能接口设计

### 4.1 计划管理

| 接口 | 方法 | URL | 功能 |
|------|------|-----|------|
| 计划列表 | GET | /students/<id>/plans | 学员的所有计划 |
| 创建计划 | GET/POST | /students/<id>/plans/create | 新建计划表单 |
| 计划详情 | GET | /plans/<id> | 查看计划详情 |
| 编辑计划 | GET/POST | /plans/<id>/edit | 编辑计划 |
| 删除计划 | POST | /plans/<id>/delete | 删除计划 |

### 4.2 目标管理

| 接口 | 方法 | URL | 功能 |
|------|------|-----|------|
| 添加目标 | POST | /plans/<id>/goals | 添加阶段目标 |
| 更新目标 | POST | /goals/<id>/update | 更新目标进度 |
| 删除目标 | POST | /goals/<id>/delete | 删除目标 |

### 4.3 任务管理

| 接口 | 方法 | URL | 功能 |
|------|------|-----|------|
| 添加任务 | POST | /plans/<id>/tasks | 添加任务 |
| 完成任务 | POST | /tasks/<id>/complete | 标记任务完成 |
| 删除任务 | POST | /tasks/<id>/delete | 删除任务 |

### 4.4 AI建议

| 接口 | 方法 | URL | 功能 |
|------|------|-----|------|
| 生成建议 | POST | /students/<id>/plans/ai-suggest | AI生成计划建议 |

---

## 5. 页面设计

### 5.1 学员详情页 - 学习计划标签

```
┌─────────────────────────────────────────────────────┐
│ [基本信息] [学习画像] [督学记录] [学习计划] [录播]    │
├─────────────────────────────────────────────────────┤
│                                                     │
│  ┌──────────────────────────────────────────────┐  │
│  │ 当前计划：冲刺阶段计划                    [编辑] │
│  │ 2026/01/15 - 2026/03/01  状态：进行中         │
│  ├──────────────────────────────────────────────┤  │
│  │                                              │  │
│  │ 阶段目标                              [添加] │  │
│  │ ┌────────────────────────────────────────┐  │  │
│  │ │ 📊 资料分析正确率 ▓▓▓▓▓▓░░░░ 65%/80% │  │  │
│  │ │ 📝 完成真题套数   ▓▓▓▓▓▓▓░░░ 7/10套  │  │  │
│  │ │ ⏱️ 行测做题时间   ▓▓▓▓░░░░░░ 115分钟 │  │  │
│  │ └────────────────────────────────────────┘  │  │
│  │                                              │  │
│  │ 本周任务                              [添加] │  │
│  │ ☑ 完成资料分析专项30道                      │  │
│  │ ☐ 做一套2024国考真题                        │  │
│  │ ☐ 复习错题本                                │  │
│  │ ⭐ 里程碑：第二次模考 (01/30)               │  │
│  │                                              │  │
│  └──────────────────────────────────────────────┘  │
│                                                     │
│  [+ 创建新计划]  [🤖 AI生成建议]                    │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 5.2 创建计划页面

```
┌─────────────────────────────────────────────────────┐
│ 创建学习计划 - 张三                                  │
├─────────────────────────────────────────────────────┤
│                                                     │
│ 基本信息                                            │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐   │
│ │ 计划名称    │ │ 学习阶段    │ │ 开始日期    │   │
│ │ [________]  │ │ [基础/提高] │ │ [2026-01-28]│   │
│ └─────────────┘ └─────────────┘ └─────────────┘   │
│                                                     │
│ 🤖 AI建议                                    [生成] │
│ ┌──────────────────────────────────────────────┐  │
│ │ 根据学员情况分析：                           │  │
│ │ • 薄弱项：资料分析(55%)、数量关系(48%)       │  │
│ │ • 距考试：45天                               │  │
│ │ • 建议：重点突破资料分析，每日30道专项练习   │  │
│ │                                              │  │
│ │ [采纳建议] [仅参考]                          │  │
│ └──────────────────────────────────────────────┘  │
│                                                     │
│ 阶段目标                                     [添加] │
│ ┌──────────────────────────────────────────────┐  │
│ │ 目标1：资料分析正确率达到80%  截止：02/15    │  │
│ │ 目标2：完成10套真题            截止：02/28    │  │
│ └──────────────────────────────────────────────┘  │
│                                                     │
│                          [取消] [保存计划]          │
└─────────────────────────────────────────────────────┘
```

---

## 6. AI建议生成逻辑

### 6.1 输入数据

```python
{
    "student": {
        "name": "张三",
        "exam_type": "2026国省考",
        "exam_date": "2026-03-15",
        "has_basic": False,
        "base_level": "零基础"
    },
    "weakness_tags": [
        {"module": "资料分析", "accuracy": 55},
        {"module": "数量关系", "accuracy": 48},
        {"module": "言语理解", "accuracy": 72}
    ],
    "homework_stats": {
        "avg_accuracy": 62,
        "completion_rate": 85,
        "recent_trend": "improving"
    },
    "days_until_exam": 45
}
```

### 6.2 输出建议

```python
{
    "phase_suggestion": "冲刺阶段",
    "focus_modules": ["资料分析", "数量关系"],
    "recommended_goals": [
        {"type": "accuracy", "module": "资料分析", "target": 80, "unit": "%"},
        {"type": "accuracy", "module": "数量关系", "target": 65, "unit": "%"},
        {"type": "quantity", "module": "真题", "target": 10, "unit": "套"}
    ],
    "recommended_tasks": [
        {"type": "daily", "title": "资料分析专项练习30道"},
        {"type": "daily", "title": "数量关系基础题15道"},
        {"type": "weekly", "title": "完成一套真题计时模拟"},
        {"type": "milestone", "title": "第一次全真模考", "days": 15}
    ],
    "notes": "建议每日学习时间不少于4小时，重点突破资料分析。"
}
```

---

## 7. 实现计划

### 7.1 开发任务

| 序号 | 任务 | 优先级 |
|------|------|--------|
| 1 | 创建数据模型 (StudyPlan, PlanGoal, PlanTask, PlanProgress) | P0 |
| 2 | 创建服务层 (plan_service.py) | P0 |
| 3 | 创建路由和接口 | P0 |
| 4 | 学员详情页添加"学习计划"标签 | P0 |
| 5 | 计划创建/编辑页面 | P0 |
| 6 | 目标和任务管理功能 | P0 |
| 7 | AI建议生成功能 | P1 |
| 8 | 进度追踪和关联数据 | P1 |

### 7.2 预估工作量

- 核心功能（数据模型+CRUD+页面）：中等
- AI建议生成：需要调用外部API或规则引擎

---

## 8. 验收标准

- [ ] 可为学员创建学习计划
- [ ] 可添加阶段目标（正确率/数量/时间）
- [ ] 可添加任务清单（日常/里程碑）
- [ ] 任务支持打勾完成
- [ ] 目标进度可视化展示
- [ ] AI可生成计划建议
- [ ] 学员详情页显示学习计划标签

---

*文档版本：v1.0 | 创建日期：2026-01-28*
