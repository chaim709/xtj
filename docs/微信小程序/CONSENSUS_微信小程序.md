# 公考学员服务微信小程序 - 共识文档

> 6A工作流 - 阶段1: Align 最终共识
> 创建日期: 2026-02-01

---

## 一、明确的需求描述

### 1.1 项目目标

为现有公考培训机构开发一款**学员服务微信小程序**，聚焦**督学互动**和**课程学习**两大核心场景，提升学员学习体验和机构服务效率。

### 1.2 核心价值

| 对学员 | 对机构 |
|-------|-------|
| 随时查看课表和录播课 | 增强学员粘性 |
| 接收督学老师的关怀消息 | 降低督学沟通成本 |
| 每日打卡形成学习习惯 | 提升学员完课率 |
| 查看学习进度和报告 | 数据驱动运营决策 |

---

## 二、技术实现方案

### 2.1 技术栈确定

| 层级 | 技术选型 | 理由 |
|-----|---------|------|
| **小程序端** | 原生微信小程序 | 性能最优，官方支持全面 |
| **UI组件库** | Vant Weapp | 组件丰富，文档完善，学习成本低 |
| **后端服务** | 复用现有Flask API | 零重构成本，已验证可用 |
| **数据库** | SQLite（复用现有） | 数据量小，无需升级 |
| **认证方案** | JWT Token | 标准、安全、易实现 |
| **消息推送** | 微信订阅消息 | 官方能力，触达率高 |

### 2.2 登录认证流程

```
用户点击登录
    ↓
wx.login() 获取 code
    ↓
后端调用微信API获取 openid
    ↓
检查 openid 是否已绑定学员
    ↓
是 → 返回JWT Token，登录成功
否 → 引导绑定手机号
    ↓
调用 wx.getPhoneNumber() 获取手机号
    ↓
后端验证手机号，匹配学员账号
    ↓
绑定 openid 与学员ID
    ↓
返回JWT Token，登录成功
```

### 2.3 后端API扩展

#### 新增API接口

| 接口路径 | 方法 | 功能 | 优先级 |
|---------|------|------|--------|
| `/api/v1/wx/login` | POST | 微信登录换取token | P0 |
| `/api/v1/wx/bind-phone` | POST | 绑定手机号到学员 | P0 |
| `/api/v1/students/me` | GET | 获取当前学员信息 | P0 |
| `/api/v1/students/me/schedule` | GET | 获取我的课表（今日/本周） | P0 |
| `/api/v1/students/me/recordings` | GET | 获取我的录播课列表 | P0 |
| `/api/v1/students/me/messages` | GET | 获取督学消息列表 | P0 |
| `/api/v1/students/me/checkin` | POST | 每日打卡 | P1 |
| `/api/v1/students/me/homework` | GET | 获取我的作业列表 | P1 |
| `/api/v1/students/me/feedback` | POST | 学员主动反馈 | P1 |
| `/api/v1/wx/subscribe-message` | POST | 订阅消息发送 | P1 |

#### 复用现有API

- ✅ `/api/v1/students/<id>` - 学员详情（需要权限控制）
- ✅ `/api/v1/batches/<id>/students` - 班次学员（仅查看同班）
- ✅ `/h5/practice/<student_id>` - 错题练习（功能复用）

#### 数据库扩展

需要在 `students` 表增加字段：

```sql
ALTER TABLE students ADD COLUMN wx_openid VARCHAR(64) UNIQUE;
ALTER TABLE students ADD COLUMN wx_unionid VARCHAR(64);
ALTER TABLE students ADD COLUMN last_checkin_date DATE;
ALTER TABLE students ADD COLUMN total_checkin_days INTEGER DEFAULT 0;
```

新增 `checkin_records` 表：

```sql
CREATE TABLE checkin_records (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    student_id INTEGER NOT NULL,
    checkin_date DATE NOT NULL,
    checkin_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (student_id) REFERENCES students(id),
    UNIQUE(student_id, checkin_date)
);
```

新增 `subscribe_templates` 表（订阅消息模板管理）：

```sql
CREATE TABLE subscribe_templates (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    template_id VARCHAR(100) NOT NULL,
    template_type VARCHAR(50) NOT NULL,
    title VARCHAR(100),
    is_active BOOLEAN DEFAULT TRUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

---

## 三、功能范围与边界

### 3.1 第一期功能（MVP - 2周）

| 模块 | 功能点 | 说明 |
|-----|-------|------|
| **登录认证** | 微信授权登录 | wx.login + openid |
|  | 手机号绑定 | wx.getPhoneNumber |
|  | Token管理 | JWT，7天有效期 |
| **学员首页** | 今日课程卡片 | 展示今日课表 |
|  | 待办任务列表 | 作业、复习提醒 |
|  | 督学消息预览 | 最新3条消息 |
| **课表模块** | 今日课表 | 科目、时间、老师 |
|  | 本周课表 | 日历视图 |
| **录播课模块** | 录播课列表 | 按科目/日期分类 |
|  | 视频外链跳转 | webview播放 |
| **我的模块** | 个人信息展示 | 姓名、班级、目标 |
|  | 学习数据统计 | 打卡天数 |

### 3.2 第二期功能（增强 - 2周）

| 模块 | 功能点 | 说明 |
|-----|-------|------|
| **督学互动** | 消息列表 | 查看全部督学消息 |
|  | 学习反馈 | 主动提交学习状态 |
|  | 扣子对话 | 嵌入智能督学Bot |
| **学习激励** | 每日打卡 | 签到、累计天数 |
|  | 打卡日历 | 可视化打卡记录 |
| **作业模块** | 作业列表 | 待完成/已完成 |
|  | 作业提交 | 标记完成 |
| **消息推送** | 上课提醒 | 提前30分钟推送 |
|  | 作业提醒 | 截止前1天推送 |

### 3.3 第三期功能（完善 - 2周）

| 模块 | 功能点 | 说明 |
|-----|-------|------|
| **错题复习** | 错题本 | 扫码录入的错题 |
|  | 复习提醒 | 艾宾浩斯曲线 |
| **学习报告** | 周报数据 | 学习时长、正确率 |
|  | 进度可视化 | 图表展示 |
| **职位查询** | 目标职位 | 快速查看 |
|  | 进面分数线 | 历史数据 |

### 3.4 明确排除

- ❌ 付费购课功能
- ❌ 在线直播
- ❌ 完整题库刷题系统
- ❌ 管理员后台
- ❌ 多机构切换

---

## 四、技术约束和集成方案

### 4.1 微信小程序约束

| 项目 | 要求 | 应对方案 |
|-----|------|---------|
| **小程序认证** | 企业/个体户，300元/年 | ✅ 用户已确认可支付 |
| **AppID申请** | 需要微信公众平台注册 | 假设：待申请（引导用户注册） |
| **域名配置** | 服务器域名需备案+HTTPS | ✅ 已有 https://shxtj.chaim.top |
| **业务域名白名单** | 视频外链需要配置 | 假设：腾讯视频、B站等主流平台 |

### 4.2 扣子智能体集成

| 项目 | 方案 | 说明 |
|-----|------|------|
| **集成方式** | 扣子官方小程序插件 | 使用扣子提供的SDK |
| **对话入口** | 督学模块独立页面 | "智能督学助手" |
| **数据联动** | API传递学员上下文 | 学员信息、学习进度 |
| **权限控制** | 仅认证学员可访问 | Token验证 |

假设：
- 扣子Bot ID：需要用户提供或新建
- 集成文档：参考扣子官方小程序接入文档

### 4.3 视频播放方案

| 方案 | 说明 | 选择 |
|-----|------|------|
| webview外链 | 跳转至视频平台播放 | ✅ 推荐（已有链接） |
| 内嵌播放器 | 小程序video组件 | ❌ 需要自建存储 |

假设视频平台：
- 腾讯视频（v.qq.com）
- 哔哩哔哩（bilibili.com）
- 其他主流平台

需在小程序后台配置业务域名白名单。

---

## 五、验收标准

### 5.1 功能验收

| 功能模块 | 验收标准 |
|---------|---------|
| **登录** | 首次用户完成微信授权+手机号绑定，老用户直接登录 |
| **首页** | 正确展示今日课程、待办任务、督学消息 |
| **课表** | 显示用户所属班次的准确课表，区分今日/本周 |
| **录播课** | 列表展示所有可观看录播，点击跳转播放正常 |
| **督学消息** | 实时接收督学老师发送的消息，支持查看历史 |
| **打卡** | 每日只能打卡一次，累计天数准确统计 |
| **订阅消息** | 用户订阅后，上课前30分钟收到提醒 |

### 5.2 性能验收

| 指标 | 标准 |
|-----|------|
| 首屏加载 | < 2秒（4G网络） |
| 页面切换 | < 500ms |
| API响应 | < 1秒 |
| 离线缓存 | 支持课表、录播列表离线查看 |

### 5.3 兼容性验收

| 平台 | 要求 |
|-----|------|
| iOS | iOS 12+ |
| Android | Android 7+ |
| 微信版本 | 8.0+ |

### 5.4 体验验收

- ✅ 通过微信小程序审核
- ✅ 界面美观，符合微信设计规范
- ✅ 操作流畅，无明显卡顿
- ✅ 错误提示友好，引导清晰

---

## 六、设计规范

### 6.1 视觉设计

| 项目 | 规范 |
|-----|------|
| **主色** | #1890FF（蓝色，专业可信） |
| **辅助色** | #FF6B00（橙色，激励强调） |
| **成功色** | #52C41A（绿色） |
| **警告色** | #FAAD14（黄色） |
| **字体大小** | 标题18px，副标题16px，正文14px，辅助12px |
| **圆角** | 按钮12px，卡片8px |
| **间距** | 16px（页面边距），12px（元素间距），8px（内边距） |

### 6.2 交互规范

| 场景 | 规范 |
|-----|------|
| **加载** | 超过500ms显示loading |
| **下拉刷新** | 列表页支持下拉刷新 |
| **错误提示** | Toast轻提示，关键错误弹窗 |
| **空状态** | 显示友好的空状态图标+文案 |
| **返回** | 支持左滑返回，保持状态 |

---

## 七、项目计划与里程碑

### 7.1 开发周期（预估6周）

| 阶段 | 周期 | 交付物 |
|-----|------|-------|
| **架构设计** | 3天 | 架构文档、原子任务清单 |
| **第一期开发** | 2周 | MVP可用小程序 |
| **第二期开发** | 2周 | 督学互动、消息推送 |
| **第三期开发** | 2周 | 错题、报告、优化 |
| **测试上线** | 3天 | 微信审核通过，正式发布 |

### 7.2 关键里程碑

| 时间节点 | 里程碑 | 交付标准 |
|---------|-------|---------|
| D+3 | 完成架构设计 | DESIGN文档、TASK文档 |
| D+17 | 第一期上线 | 基础功能可用，内部测试通过 |
| D+31 | 第二期上线 | 督学互动完整，订阅消息可用 |
| D+45 | 正式发布 | 微信审核通过，全量开放 |

---

## 八、关键假设与决策

### 8.1 已确认决策

| 决策点 | 决定 | 依据 |
|-------|------|------|
| 认证方式 | 企业/个体户认证 | 用户确认可支付300元/年 |
| 登录方式 | 微信授权+手机号绑定 | 用户需求明确 |
| 开发方式 | 原生小程序 | 用户需求明确 |
| 视频来源 | 外链播放 | 用户已有视频平台链接 |
| 消息推送 | 订阅消息 | 用户需求明确 |

### 8.2 合理假设（待验证）

| 假设项 | 假设内容 | 验证方式 |
|-------|---------|---------|
| 小程序名称 | "公考学员助手" | 用户确认或修改 |
| AppID | 尚未申请 | 引导用户申请 |
| 扣子Bot | 需要新建或已有 | 用户提供Bot ID |
| 视频平台 | 腾讯视频、B站为主 | 检查数据库录播链接 |

---

## 九、风险与应对

| 风险 | 概率 | 影响 | 应对方案 |
|-----|------|------|---------|
| 小程序审核被拒 | 中 | 高 | 严格遵守微信规范，避免敏感词 |
| 认证流程耗时 | 中 | 中 | 提前指导用户准备材料 |
| 视频外链限制 | 低 | 中 | 使用主流平台，配置白名单 |
| 用户学习成本高 | 中 | 低 | 提供详细文档和示例代码 |
| 后端性能瓶颈 | 低 | 中 | 初期用户少，后续可优化 |

---

## 十、下一步行动

✅ **Align阶段完成**

⏭️ **进入Architect阶段**：
1. 设计小程序整体架构
2. 设计页面结构和导航
3. 设计后端API详细规范
4. 设计数据库模型扩展
5. 绘制系统架构图和数据流图

---

> **共识确认**：本文档基于用户需求和现有系统分析形成，部分假设内容（小程序名称、AppID、扣子Bot）待用户最终确认。
> 
> **状态**：已完成对齐 ✅  
> **下一步**：架构设计 📐
