# 微信开发者工具 - 联合开发指南

> 如何使用微信开发者工具开发和调试小程序
> 创建日期: 2026-02-01

---

## 一、下载和安装

### 1.1 下载微信开发者工具

访问官方下载页面：
```
https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html
```

选择对应版本：
- **macOS**: 点击 "macOS" 下载 .dmg 文件
- Windows: 点击 "Windows 64" 下载
- Linux: 点击 "Linux" 下载

### 1.2 安装

**macOS**:
1. 打开下载的 `.dmg` 文件
2. 将「微信开发者工具」拖入「应用程序」文件夹
3. 在「应用程序」中找到并打开「微信开发者工具」
4. 首次打开需要允许系统权限

**首次登录**:
- 使用微信扫码登录
- 建议使用常用微信账号

---

## 二、导入项目

### 2.1 打开项目

1. 启动微信开发者工具
2. 点击左侧「+」→「导入项目」
3. 填写项目信息：

| 字段 | 值 |
|-----|---|
| **项目名称** | 公考学员助手 |
| **目录** | 点击「选择」→ 选择 `gongkao-miniprogram` 文件夹 |
| **AppID** | 如果没有，选择「测试号」或「小程序」 |
| **开发模式** | 小程序 |

4. 点击「导入」

### 2.2 使用测试号（推荐先这样开发）

如果你还没有正式AppID：

1. 在AppID输入框选择「测试号」
2. 测试号限制：
   - ✅ 可以调试所有功能
   - ✅ 可以真机预览
   - ❌ 无法发布上线
   - ❌ 部分API受限（如微信支付）

### 2.3 首次打开可能出现的问题

**问题1：找不到 app.json**
```
解决：确保选择的目录是 gongkao-miniprogram（包含 app.json 的目录）
```

**问题2：npm包未构建**
```
解决：点击工具栏「工具」→「构建 npm」
```

---

## 三、开发环境配置

### 3.1 构建 npm 包（重要！）

由于我们使用了 Vant Weapp 组件库，必须先构建 npm：

1. 在项目根目录打开终端（或使用开发者工具内置终端）
2. 安装依赖：
   ```bash
   npm install
   ```
3. 在开发者工具中：
   - 点击菜单栏「工具」→「构建 npm」
   - 等待构建完成（右下角会显示构建结果）

### 3.2 项目配置

在开发者工具中，点击「详情」tab，检查配置：

| 配置项 | 建议值 |
|-------|-------|
| **ES6 转 ES5** | ✅ 勾选 |
| **增强编译** | ✅ 勾选 |
| **不校验合法域名** | ✅ 勾选（开发阶段） |
| **启用自动补全** | ✅ 勾选 |

**重要**：「不校验合法域名」在开发时必须勾选，否则无法访问后端API！

### 3.3 编译模式

创建自定义编译模式，方便调试：

1. 工具栏点击「普通编译」旁的下拉箭头
2. 点击「添加编译模式」
3. 创建以下模式：

| 模式名称 | 启动页面 | 启动参数 | 用途 |
|---------|---------|---------|------|
| 登录页 | pages/login/index | - | 测试登录 |
| 首页 | pages/index/index | - | 测试首页 |
| 课表 | pages/schedule/index | - | 测试课表 |
| 消息 | pages/messages/index | - | 测试消息 |

---

## 四、开发工作流

### 4.1 日常开发流程

```
┌─────────────────────────────────────┐
│ 1. Cursor 编辑代码                   │
│    修改 .js / .wxml / .wxss 文件    │
└─────────────┬───────────────────────┘
              │
┌─────────────▼───────────────────────┐
│ 2. 保存文件（Cmd+S）                 │
│    微信开发者工具会自动刷新          │
└─────────────┬───────────────────────┘
              │
┌─────────────▼───────────────────────┐
│ 3. 查看效果                          │
│    在模拟器中查看变化                │
└─────────────┬───────────────────────┘
              │
┌─────────────▼───────────────────────┐
│ 4. 调试（如有问题）                  │
│    打开调试器，查看 Console/Network  │
└─────────────────────────────────────┘
```

### 4.2 推荐的开发方式

**方案A：双屏开发（推荐）**
```
左屏：Cursor 编辑器
右屏：微信开发者工具（模拟器+调试器）
```

**方案B：单屏开发**
```
Cursor 编辑器占 60% 屏幕
微信开发者工具占 40% 屏幕
```

### 4.3 文件编辑协同

| 编辑器 | 推荐用途 | 原因 |
|-------|---------|------|
| **Cursor** | 编写代码、重构 | AI辅助、代码提示好 |
| **微信开发者工具** | 查看效果、调试 | 实时预览、调试工具强 |

**不要**在两个编辑器同时编辑同一个文件，会导致冲突！

---

## 五、调试技巧

### 5.1 打开调试器

在微信开发者工具中：
1. 点击模拟器区域右侧的「调试器」tab
2. 或者快捷键：`Cmd + Shift + I` (macOS)

### 5.2 调试器面板说明

| 面板 | 用途 | 常用场景 |
|-----|------|---------|
| **Console** | 查看日志、错误 | 调试 console.log、错误信息 |
| **Network** | 查看网络请求 | 调试API调用、查看响应 |
| **Sources** | 断点调试 | 复杂逻辑调试 |
| **Storage** | 查看本地数据 | 查看 token、缓存数据 |
| **AppData** | 查看页面数据 | 查看 Page.data 变化 |
| **Wxml** | 查看页面结构 | 调试样式、布局 |

### 5.3 常用调试命令

在 Console 中可以使用：

```javascript
// 查看当前页面实例
getCurrentPages()[0]

// 查看当前页面data
getCurrentPages()[0].data

// 手动调用页面方法
getCurrentPages()[0].loadData()

// 查看全局数据
getApp().globalData

// 清除本地存储
wx.clearStorage()
```

### 5.4 查看 API 请求

1. 打开「Network」面板
2. 刷新页面或触发请求
3. 点击具体请求，查看：
   - **Headers**: 请求头（检查 Authorization）
   - **Response**: 响应数据
   - **Timing**: 请求耗时

**调试技巧**：
```javascript
// 在 utils/request.js 中添加日志
console.log('请求URL:', url);
console.log('请求参数:', data);
console.log('响应数据:', res.data);
```

---

## 六、真机调试

### 6.1 预览

1. 点击工具栏「预览」按钮
2. 生成二维码
3. 用微信扫码
4. 在手机上查看效果

**注意**：
- 手机和电脑需在同一局域网（或使用测试号）
- 首次扫码需要授权

### 6.2 真机调试（推荐）

1. 点击工具栏「真机调试」按钮
2. 扫码后，手机会连接到开发者工具
3. 可以在开发者工具的调试器中查看手机日志

**优势**：
- ✅ 实时查看手机端日志
- ✅ 调试 Console/Network
- ✅ 模拟真实环境

### 6.3 真机调试常见问题

**问题1：真机无法访问后端API**
```
原因：手机无法访问 localhost
解决：使用局域网IP或外网域名
```

**问题2：扫码后白屏**
```
原因：可能是 npm 包未构建
解决：重新「构建 npm」
```

---

## 七、后端 API 联调

### 7.1 配置后端地址

在 `app.js` 中：

```javascript
App({
  globalData: {
    // 开发环境：使用测试服务器
    baseUrl: 'https://shxtj.chaim.top/api/v1',
    
    // 如果本地调试后端：
    // baseUrl: 'http://你的局域网IP:5000/api/v1'
  }
})
```

### 7.2 本地后端调试

如果你想在本地调试后端：

1. **找到本机局域网IP**：
   ```bash
   # macOS/Linux
   ifconfig | grep "inet "
   
   # 找到类似 192.168.x.x 的IP
   ```

2. **修改 baseUrl**：
   ```javascript
   baseUrl: 'http://192.168.1.100:5000/api/v1'
   ```

3. **启动本地后端**：
   ```bash
   cd gongkao-system
   source venv/bin/activate
   python run.py
   ```

4. **关闭域名校验**：
   - 开发者工具 → 详情 → 本地设置 → 不校验合法域名 ✅

### 7.3 查看 API 调用

在 `utils/request.js` 中已有日志，打开 Console 可以看到：

```
请求: GET /students/me
响应: {success: true, data: {...}}
```

---

## 八、常见问题解决

### 8.1 组件不显示

**症状**：页面空白，Console 报错 `Component is not found in path`

**解决**：
1. 检查是否执行了「构建 npm」
2. 检查 `app.json` 中 `usingComponents` 配置
3. 重启开发者工具

### 8.2 API 请求失败

**症状**：Network 中请求显示红色，或返回404

**检查清单**：
1. ✅ 是否勾选「不校验合法域名」
2. ✅ baseUrl 是否正确
3. ✅ 后端服务是否启动
4. ✅ 网络是否连通

**调试方法**：
```javascript
// 在 utils/request.js 的 fail 回调中
fail: (err) => {
  console.error('请求失败:', err);
  console.log('URL:', url);
  console.log('完整URL:', BASE_URL + url);
}
```

### 8.3 页面不刷新

**症状**：修改代码后，模拟器没有变化

**解决**：
1. 手动点击「编译」按钮
2. 检查是否保存了文件
3. 清除缓存：工具栏 → 清除缓存 → 清除编译缓存

### 8.4 样式不生效

**检查**：
1. wxss 文件是否有语法错误
2. class 名称是否正确
3. 样式优先级是否被覆盖

**调试**：
- 打开「Wxml」面板
- 点击元素，查看右侧「Styles」
- 查看哪些样式被应用/覆盖

---

## 九、开发技巧

### 9.1 快捷键

| 快捷键 | 功能 |
|-------|------|
| `Cmd + S` | 保存并编译 |
| `Cmd + R` | 重新编译 |
| `Cmd + Shift + I` | 打开/关闭调试器 |
| `Cmd + B` | 切换模拟器显示 |

### 9.2 模拟器设置

1. 点击模拟器右上角「...」
2. 可以设置：
   - 设备型号（iPhone、Android）
   - 屏幕分辨率
   - 网络状态（模拟弱网）

### 9.3 自动保存和编译

设置 → 编辑器设置：
- ✅ 保存时自动编译
- ✅ 自动保存

---

## 十、上传和发布

### 10.1 上传代码

当开发完成后：

1. 确保所有代码已提交到git
2. 点击工具栏「上传」按钮
3. 填写版本号和备注：
   ```
   版本号：1.0.0
   备注：首个正式版本，包含基础功能
   ```
4. 点击「上传」

### 10.2 提交审核

1. 登录微信公众平台：https://mp.weixin.qq.com
2. 左侧菜单 → 版本管理
3. 找到开发版本 → 提交审核
4. 填写审核信息（功能说明、隐私政策等）
5. 等待审核（一般1-7天）

### 10.3 发布上线

审核通过后：
1. 版本管理 → 审核版本
2. 点击「发布」
3. 用户即可搜索和使用小程序

---

## 十一、最佳实践

### 11.1 开发建议

1. **先用测试号开发**
   - 不需要企业认证
   - 功能完整，只是不能发布

2. **开发时关闭域名校验**
   - 方便调试
   - 上线前记得打开

3. **使用真机调试**
   - 模拟器和真机可能有差异
   - 特别是授权、支付等功能

4. **多端测试**
   - iOS 和 Android 都要测试
   - 不同机型可能有兼容性问题

### 11.2 代码管理

```bash
# 定期提交代码
cd gongkao-miniprogram
git add .
git commit -m "feat: 添加xxx功能"
git push

# 打tag标记版本
git tag v1.0.0
git push --tags
```

---

## 十二、参考资源

| 资源 | 链接 |
|-----|------|
| 官方文档 | https://developers.weixin.qq.com/miniprogram/dev/framework/ |
| 开发者工具 | https://developers.weixin.qq.com/miniprogram/dev/devtools/devtools.html |
| Vant Weapp | https://vant-contrib.gitee.io/vant-weapp/ |
| 组件库 | https://developers.weixin.qq.com/miniprogram/dev/component/ |
| API文档 | https://developers.weixin.qq.com/miniprogram/dev/api/ |

---

## 总结

联合开发流程：

```
Cursor (编写代码)
    ↓ 保存
微信开发者工具 (自动刷新)
    ↓ 查看效果
调试器 (查看日志/网络)
    ↓ 发现问题
Cursor (修复代码)
    ↓ 循环...
```

**关键点**：
- ✅ 使用测试号开始开发
- ✅ 构建 npm 包
- ✅ 关闭域名校验
- ✅ 使用真机调试
- ✅ 定期提交代码

有问题随时查看这个指南！
