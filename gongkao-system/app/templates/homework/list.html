{% extends "base.html" %}

{% block title %}作业管理 - 公考培训管理系统{% endblock %}

{% block content %}
<!-- 页面标题 -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h4 class="font-heading mb-1">作业管理</h4>
        <p class="text-muted mb-0">发布和管理学员作业任务</p>
    </div>
    <a href="{{ url_for('homework.create') }}" class="btn btn-primary" style="border-radius:10px;">
        <i data-lucide="file-plus" style="width:18px;height:18px;margin-right:6px;"></i>
        发布作业
    </a>
</div>

<!-- 筛选和操作 -->
<div class="card mb-4" style="border-radius:16px;border:none;box-shadow:0 1px 3px rgba(0,0,0,0.05);">
    <div class="card-body">
        <form method="GET" class="d-flex gap-3 align-items-center">
            <div>
                <select class="form-select" name="status" style="border-radius:8px;min-width:140px;">
                    <option value="">全部状态</option>
                    <option value="published" {% if current_status == 'published' %}selected{% endif %}>进行中</option>
                    <option value="closed" {% if current_status == 'closed' %}selected{% endif %}>已关闭</option>
                </select>
            </div>
            <button type="submit" class="btn btn-outline-primary" style="border-radius:8px;">
                <i data-lucide="filter" style="width:16px;height:16px;margin-right:4px;"></i> 筛选
            </button>
            <a href="{{ url_for('homework.list') }}" class="btn btn-outline-secondary" style="border-radius:8px;">重置</a>
        </form>
    </div>
</div>

<!-- 作业列表 -->
<div class="card" style="border-radius:16px;border:none;box-shadow:0 1px 3px rgba(0,0,0,0.05);">
    <div class="card-header bg-white d-flex justify-content-between align-items-center" style="border-radius:16px 16px 0 0;border-bottom:1px solid #F1F5F9;">
        <span class="font-heading" style="font-weight:600;">
            <i data-lucide="book-open" style="width:18px;height:18px;margin-right:8px;color:var(--primary);"></i>
            作业列表
        </span>
        <span class="badge" style="background:#EFF6FF;color:var(--primary);font-weight:500;">共 {{ tasks.total }} 个</span>
    </div>
    <div class="card-body">
        {% if tasks.items %}
        <div class="row g-4">
            {% for task in tasks.items %}
            <div class="col-md-6 col-lg-4">
                <div class="card h-100" style="border-radius:12px;border:1px solid #E2E8F0;transition:all 0.2s;cursor:pointer;" 
                     onclick="location.href='{{ url_for('homework.detail', id=task.id) }}'"
                     onmouseover="this.style.borderColor='var(--primary)';this.style.boxShadow='0 4px 12px rgba(37,99,235,0.1)';"
                     onmouseout="this.style.borderColor='#E2E8F0';this.style.boxShadow='none';">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <h6 class="font-heading mb-0" style="font-weight:600;">{{ task.task_name }}</h6>
                            {% if task.status == 'published' %}
                            <span class="badge" style="background:#DCFCE7;color:#16A34A;">进行中</span>
                            {% else %}
                            <span class="badge" style="background:#F1F5F9;color:#64748B;">已关闭</span>
                            {% endif %}
                        </div>
                        
                        <div class="mb-2" style="color:#64748B;font-size:0.85rem;">
                            <i data-lucide="book" style="width:14px;height:14px;margin-right:4px;"></i>
                            {{ task.module or '未分类' }}{% if task.sub_module %} - {{ task.sub_module }}{% endif %}
                        </div>
                        
                        <div class="d-flex gap-3 mb-2" style="color:#64748B;font-size:0.85rem;">
                            <span>
                                <i data-lucide="hash" style="width:14px;height:14px;margin-right:2px;"></i>
                                {{ task.question_count or '-' }} 题
                            </span>
                            {% if task.suggested_time %}
                            <span>
                                <i data-lucide="clock" style="width:14px;height:14px;margin-right:2px;"></i>
                                {{ task.suggested_time }}分钟
                            </span>
                            {% endif %}
                        </div>
                        
                        {% if task.deadline %}
                        <div class="mb-3" style="color:#64748B;font-size:0.85rem;">
                            <i data-lucide="calendar" style="width:14px;height:14px;margin-right:4px;"></i>
                            截止：{{ task.deadline.strftime('%m月%d日 %H:%M') }}
                        </div>
                        {% endif %}
                        
                        <div class="d-flex justify-content-between align-items-center pt-2 border-top">
                            <div style="color:#94A3B8;font-size:0.8rem;">
                                <i data-lucide="user" style="width:12px;height:12px;margin-right:2px;"></i>
                                {{ task.creator.real_name if task.creator else '未知' }}
                            </div>
                            <div style="color:#94A3B8;font-size:0.8rem;">
                                {{ task.created_at.strftime('%m-%d') if task.created_at else '' }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- 分页 -->
        {% if tasks.pages > 1 %}
        <nav class="mt-4">
            <ul class="pagination justify-content-center mb-0">
                <li class="page-item {% if not tasks.has_prev %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('homework.list', page=tasks.prev_num, status=current_status) }}" style="border-radius:8px;">上一页</a>
                </li>
                {% for p in tasks.iter_pages() %}
                    {% if p %}
                    <li class="page-item {% if p == tasks.page %}active{% endif %}">
                        <a class="page-link" href="{{ url_for('homework.list', page=p, status=current_status) }}" style="border-radius:8px;">{{ p }}</a>
                    </li>
                    {% endif %}
                {% endfor %}
                <li class="page-item {% if not tasks.has_next %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('homework.list', page=tasks.next_num, status=current_status) }}" style="border-radius:8px;">下一页</a>
                </li>
            </ul>
        </nav>
        {% endif %}
        
        {% else %}
        <div class="text-center py-5">
            <i data-lucide="inbox" style="width:64px;height:64px;color:#CBD5E1;"></i>
            <p class="text-muted mt-3 mb-4">暂无作业</p>
            <a href="{{ url_for('homework.create') }}" class="btn btn-primary" style="border-radius:10px;">
                <i data-lucide="file-plus" style="width:16px;height:16px;margin-right:6px;"></i>
                发布第一个作业
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    lucide.createIcons();
});
</script>
{% endblock %}
