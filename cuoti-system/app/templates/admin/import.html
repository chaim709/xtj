{% extends "admin/base.html" %}

{% block title %}导入题目 - 错题收集系统{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">导入题目</h1>
    <a href="{{ url_for('admin.questions') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> 返回题目列表
    </a>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-upload"></i> 上传文档
            </div>
            <div class="card-body">
                <form method="post" action="{{ url_for('admin.upload_document') }}" enctype="multipart/form-data">
                    <div class="upload-area text-center p-5 border-2 border-dashed rounded mb-4" 
                         style="border: 2px dashed #dee2e6; background: #f8f9fa; cursor: pointer;"
                         onclick="document.getElementById('fileInput').click()">
                        <i class="bi bi-cloud-upload" style="font-size: 3rem; color: #6c757d;"></i>
                        <p class="mt-3 mb-1">点击或拖拽文件到此处</p>
                        <p class="text-muted small">支持 Word (.docx)、PDF、Excel (.xlsx) 格式</p>
                        <input type="file" id="fileInput" name="file" accept=".docx,.pdf,.xlsx,.xls" 
                               style="display: none;" onchange="updateFileName(this)">
                    </div>
                    
                    <div id="fileInfo" class="alert alert-info" style="display: none;">
                        <i class="bi bi-file-earmark"></i> 
                        <span id="fileName"></span>
                        <button type="button" class="btn-close float-end" onclick="clearFile()"></button>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg" id="uploadBtn" disabled>
                            <i class="bi bi-arrow-right-circle"></i> 解析文档
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-info-circle"></i> 格式说明
            </div>
            <div class="card-body">
                <h6>Word/PDF 文档</h6>
                <p class="small text-muted">
                    系统会自动识别题号和选项格式：
                </p>
                <ul class="small text-muted">
                    <li>题号：1. 2. 或 (1) (2) 或 第1题</li>
                    <li>选项：A. B. C. D. 或 A、B、C、D</li>
                </ul>
                
                <hr>
                
                <h6>Excel 文档</h6>
                <p class="small text-muted">
                    推荐使用以下列名：
                </p>
                <ul class="small text-muted">
                    <li>题干、选项A、选项B、选项C、选项D</li>
                    <li>答案、解析、分类、知识点、难度</li>
                </ul>
                
                <hr>
                
                <div class="d-grid">
                    <a href="#" class="btn btn-outline-secondary btn-sm">
                        <i class="bi bi-download"></i> 下载Excel模板
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function updateFileName(input) {
    if (input.files.length > 0) {
        document.getElementById('fileName').textContent = input.files[0].name;
        document.getElementById('fileInfo').style.display = 'block';
        document.getElementById('uploadBtn').disabled = false;
    }
}

function clearFile() {
    document.getElementById('fileInput').value = '';
    document.getElementById('fileInfo').style.display = 'none';
    document.getElementById('uploadBtn').disabled = true;
}

// 拖拽上传
const uploadArea = document.querySelector('.upload-area');

uploadArea.addEventListener('dragover', function(e) {
    e.preventDefault();
    this.style.borderColor = '#6366f1';
    this.style.background = '#e0e7ff';
});

uploadArea.addEventListener('dragleave', function(e) {
    e.preventDefault();
    this.style.borderColor = '#dee2e6';
    this.style.background = '#f8f9fa';
});

uploadArea.addEventListener('drop', function(e) {
    e.preventDefault();
    this.style.borderColor = '#dee2e6';
    this.style.background = '#f8f9fa';
    
    const files = e.dataTransfer.files;
    if (files.length > 0) {
        document.getElementById('fileInput').files = files;
        updateFileName(document.getElementById('fileInput'));
    }
});
</script>
{% endblock %}
