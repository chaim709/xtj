{% extends "admin/base.html" %}

{% block title %}数据导入 - 错题收集系统{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title"><i class="bi bi-cloud-upload me-2"></i>数据批量导入</h1>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-file-earmark-excel me-2"></i>导入学员做题记录
            </div>
            <div class="card-body">
                <form action="{{ url_for('admin.data_import') }}" method="POST" enctype="multipart/form-data">
                    <div class="mb-4">
                        <label class="form-label fw-bold">选择Excel文件</label>
                        <div class="upload-area border-2 border-dashed rounded p-4 text-center" id="dropZone">
                            <i class="bi bi-file-earmark-excel fs-1 text-success mb-2 d-block"></i>
                            <p class="mb-2">拖拽Excel文件到此处，或点击选择</p>
                            <input type="file" name="file" id="fileInput" accept=".xlsx,.xls" style="display: none;">
                            <button type="button" class="btn btn-outline-success btn-sm" onclick="document.getElementById('fileInput').click()">
                                <i class="bi bi-folder2-open me-1"></i>选择文件
                            </button>
                            <div id="filePreview" class="mt-3" style="display: none;">
                                <div class="alert alert-success py-2 mb-0">
                                    <i class="bi bi-file-earmark-check me-2"></i>
                                    <span id="fileName"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="bi bi-cloud-upload me-2"></i>开始导入
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-info-circle me-2"></i>使用说明
            </div>
            <div class="card-body">
                <ol class="mb-3">
                    <li class="mb-2">下载Excel模板</li>
                    <li class="mb-2">按模板格式填写数据</li>
                    <li class="mb-2">上传Excel文件</li>
                    <li class="mb-2">等待导入完成</li>
                </ol>
                
                <a href="{{ url_for('admin.download_import_template') }}" class="btn btn-outline-primary w-100">
                    <i class="bi bi-download me-2"></i>下载导入模板
                </a>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <i class="bi bi-list-check me-2"></i>必填字段
            </div>
            <div class="card-body">
                <table class="table table-sm mb-0">
                    <tr>
                        <td><code>学员姓名</code></td>
                        <td><span class="badge bg-danger">必填</span></td>
                    </tr>
                    <tr>
                        <td><code>做题数</code></td>
                        <td><span class="badge bg-danger">必填</span></td>
                    </tr>
                    <tr>
                        <td><code>错题数</code></td>
                        <td><span class="badge bg-danger">必填</span></td>
                    </tr>
                    <tr>
                        <td><code>手机号</code></td>
                        <td><span class="badge bg-secondary">选填</span></td>
                    </tr>
                    <tr>
                        <td><code>题册名称</code></td>
                        <td><span class="badge bg-secondary">选填</span></td>
                    </tr>
                    <tr>
                        <td><code>板块</code></td>
                        <td><span class="badge bg-secondary">选填</span></td>
                    </tr>
                    <tr>
                        <td><code>日期</code></td>
                        <td><span class="badge bg-secondary">选填</span></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
var dropZone = document.getElementById('dropZone');
var fileInput = document.getElementById('fileInput');

dropZone.addEventListener('dragover', function(e) {
    e.preventDefault();
    this.style.borderColor = '#198754';
    this.style.backgroundColor = '#f8fff8';
});

dropZone.addEventListener('dragleave', function(e) {
    e.preventDefault();
    this.style.borderColor = '#dee2e6';
    this.style.backgroundColor = '';
});

dropZone.addEventListener('drop', function(e) {
    e.preventDefault();
    this.style.borderColor = '#dee2e6';
    this.style.backgroundColor = '';
    
    if (e.dataTransfer.files.length > 0) {
        fileInput.files = e.dataTransfer.files;
        showFilePreview(e.dataTransfer.files[0]);
    }
});

fileInput.addEventListener('change', function() {
    if (this.files.length > 0) {
        showFilePreview(this.files[0]);
    }
});

function showFilePreview(file) {
    document.getElementById('fileName').textContent = file.name + ' (' + (file.size / 1024).toFixed(1) + ' KB)';
    document.getElementById('filePreview').style.display = 'block';
}
</script>
{% endblock %}
